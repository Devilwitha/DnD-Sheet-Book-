#:import MapGridWidget ui.custom_widgets.MapGridWidget

<DMMainScreen>:
    BoxLayout:
        orientation: 'vertical' if app.platform == 'android' else 'horizontal'
        padding: 5 if app.platform == 'android' else 10
        spacing: 5 if app.platform == 'android' else 10

        # Left side: Players and Enemies
        BoxLayout:
            orientation: 'vertical'
            size_hint_x: None if app.platform == 'android' else 0.25
            size_hint_y: 0.3 if app.platform == 'android' else 1.0
            spacing: 5 if app.platform == 'android' else 10

            Label:
                text: "Online Spieler"
                font_size: '20sp'
                size_hint_y: None
                height: 40
            ScrollView:
                GridLayout:
                    id: online_players_list
                    cols: 1
                    size_hint_y: None
                    height: self.minimum_height

            Label:
                text: "Offline Spieler"
                font_size: '20sp'
                size_hint_y: None
                height: 40
            ScrollView:
                GridLayout:
                    id: offline_players_list
                    cols: 1
                    size_hint_y: None
                    height: self.minimum_height

            Label:
                text: "Gegner"
                font_size: '20sp'
                size_hint_y: None
                height: 40
            ScrollView:
                GridLayout:
                    id: enemies_list
                    cols: 1
                    size_hint_y: None
                    height: self.minimum_height

            Label:
                text: "Objekte"
                font_size: '20sp'
                size_hint_y: None
                height: 40
            ScrollView:
                GridLayout:
                    id: objects_list
                    cols: 1
                    size_hint_y: None
                    height: self.minimum_height

        # Center: Map
        MapGridWidget:
            id: dm_map_grid
            size_hint_x: None if app.platform == 'android' else 0.5
            size_hint_y: 0.5 if app.platform == 'android' else 1.0

        # Right side: Controls and Log (Android-optimiert)
        BoxLayout:
            orientation: 'vertical'
            size_hint_x: None if app.platform == 'android' else 0.27
            size_hint_y: 0.2 if app.platform == 'android' else 1.0
            padding: 5 if app.platform == 'android' else 8
            spacing: 5 if app.platform == 'android' else 12
            canvas.before:
                Color:
                    rgba: 0.12, 0.12, 0.12, 0.12
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [16]
            ScrollView:
                do_scroll_x: False
                do_scroll_y: True
                BoxLayout:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: 12
                    Label:
                        text: "Initiative"
                        font_size: '24sp'
                        bold: True
                        size_hint_y: None
                        height: 44
                    ScrollView:
                        size_hint_y: None
                        height: 100
                        GridLayout:
                            id: initiative_list
                            cols: 1
                            size_hint_y: None
                            height: self.minimum_height
                    Label:
                        id: current_turn_label
                        text: "Am Zug: Niemand"
                        font_size: '20sp'
                        size_hint_y: None
                        height: 40
                    GridLayout:
                        cols: 2
                        spacing: 8
                        size_hint_y: None
                        height: self.minimum_height
                        Button:
                            text: "Runde beenden"
                            on_press: root.end_turn()
                            font_size: '20sp'
                            size_hint_y: None
                            height: 48
                        Button:
                            text: "Initiative f端r alle w端rfeln"
                            on_press: root.roll_initiative_for_all()
                            font_size: '20sp'
                            size_hint_y: None
                            height: 48
                        Button:
                            text: "Offline Spieler hinzuf端gen"
                            on_press: root.add_offline_player()
                            font_size: '20sp'
                            size_hint_y: None
                            height: 48
                        Button:
                            text: "Gegner hinzuf端gen"
                            on_press: root.add_enemy()
                            font_size: '20sp'
                            size_hint_y: None
                            height: 48
                        Button:
                            text: "Sitzung speichern"
                            on_press: root.save_session()
                            font_size: '20sp'
                            size_hint_y: None
                            height: 48
                        Button:
                            text: "Karte laden"
                            on_press: root.load_map_popup()
                            font_size: '20sp'
                            size_hint_y: None
                            height: 48
                        Button:
                            text: "Neue Karte erstellen"
                            on_press: root.create_new_map()
                            font_size: '20sp'
                            size_hint_y: None
                            height: 48
                        Button:
                            text: "Karte bearbeiten"
                            on_press: root.edit_existing_map()
                            font_size: '20sp'
                            size_hint_y: None
                            height: 48
                        Button:
                            text: "Lobby"
                            on_press: app.change_screen('dm_lobby')
                            font_size: '20sp'
                            size_hint_y: None
                            height: 48
                    Label:
                        text: "Log"
                        font_size: '22sp'
                        size_hint_y: None
                        height: 40
                    ScrollView:
                        size_hint_y: None
                        height: 260
                        Label:
                            id: log_output
                            text: "Game log will appear here..."
                            size_hint_y: None
                            height: self.texture_size[1]
                            text_size: self.width, None
                            halign: 'left'
                            valign: 'top'
                            markup: True
